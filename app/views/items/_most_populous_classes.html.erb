<%
# WontoMedia - a wontology web application
# Copyright (C) 2010 - Glen E. Ivey
#    www.wontology.com
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License version
# 3 as published by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program in the file COPYING and/or LICENSE.  If not,
# see "http://www.gnu.org/licenses/".
%>

<style>
  #class-item-list {
    padding-left: 1.3em;
    font-size: 110%;
  }
  #class-item-list li {
    color: yellow;
    margin-bottom: 0.8ex;
  }
  #class-item-list li span {
    color: black;
  }
</style>

<div class="subheading">Most Used</div>
<ul id="class-item-list">

<%
  class_items = @class_list.select do |class_item|
    (class_item.flags & Item::DATA_IS_UNALTERABLE) == 0
  end

  iio_item_id = Item.find_by_name('is_instance_of').id
  counts = {}
  class_items.each do |class_item|
    counts[class_item] = Connection.all( :conditions => [
      "predicate_id = ? AND obj_id = ?", iio_item_id, class_item.id ] ).length
  end

  class_items.sort{|a,b| counts[b] <=> counts[a]}.
      each do |item| %>
    <li><span>
      <%= link_to "#{h filter_parenthetical item.title}",
            item_by_name_path(item.name) %>
    </span></li>
<%  end %>

</ul>
